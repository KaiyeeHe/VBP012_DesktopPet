<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘é’±è±¹æ¡Œé¢å® ç‰©</title>
    <style>
        /* === æ¡Œé¢ç«¯é€‚é… === */
        body {
            background-color: transparent; /* å…³é”®ï¼šé€æ˜èƒŒæ™¯ */
            margin: 0;
            overflow: hidden;
            font-family: 'Comic Sans MS', 'Microsoft YaHei', sans-serif;
            user-select: none;
            height: 100vh;
            width: 100vw;
        }

        /* ä¿¡æ¯æ ä½ç½® - æ”¾åœ¨å® ç‰©å®¹å™¨å†…éƒ¨ */
        #piggy-bank {
            position: absolute;
            top: 110px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 6px 10px;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 1px 1px 0px rgba(0,0,0,0.1);
            font-size: 11px;
            z-index: 90;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: default;
            pointer-events: auto;
            min-width: 160px;
        }

        #piggy-bank .info-row {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        #piggy-bank .control-buttons {
            display: flex;
            gap: 4px;
            margin-top: 2px;
        }

        #piggy-bank button {
            background: #fff;
            border: 1.5px solid #000;
            border-radius: 3px;
            padding: 3px 6px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.1s;
            box-shadow: 0 1px #000;
            min-width: 28px;
            color: #000;
        }

        #piggy-bank button:hover {
            background: #f5f5f5;
        }

        #piggy-bank button:active {
            box-shadow: 0 0 #000;
            transform: translateY(1px);
        }
        
        #work-timer {
            font-family: monospace;
            font-weight: bold;
            color: #555;
            background: #eee;
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* å® ç‰©å®¹å™¨ - ä¿®å¤æ‹–æ‹½é—®é¢˜ */
        #pet-container {
            position: fixed;
            width: 120px;
            cursor: grab;
            z-index: 100;
            left: 50%;
            top: 30%;
            transform: translate(-50%, -50%);
            pointer-events: auto;
        }

        #pet-container:active { cursor: grabbing; }

        /* è§†è§‰ä¸»ä½“ */
        .leopard-visual {
            font-size: 70px;
            text-align: center;
            line-height: 100px;
            filter: drop-shadow(3px 3px 0px rgba(0,0,0,0.15));
            pointer-events: none;
            animation: idle-bounce 2s infinite ease-in-out;
        }

        /* æ°”æ³¡ */
        .bubble {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            border: 2px solid #333;
            padding: 8px;
            border-radius: 12px 12px 12px 3px;
            width: 180px;
            display: none;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.15);
            text-align: center;
            z-index: 110;
        }
        .bubble h3 { margin: 0 0 4px 0; font-size: 13px; color: #d35400; }
        .bubble p { margin: 0 0 6px 0; font-size: 12px; color: #555; line-height: 1.3; }

        /* ç´§å¼ æ¨¡å¼ UI */
        .urgent-mode .bubble { border-color: #c0392b; background-color: #fff5f5; animation: shake-tiny 0.5s infinite; }
        .urgent-mode #action-title { color: #c0392b; font-weight: 800; }

        /* å€’è®¡æ—¶ */
        #countdown-display {
            font-size: 22px;
            font-weight: 900;
            color: #e74c3c;
            display: none;
            margin: 3px 0;
            text-shadow: 1px 1px 0 #fff;
        }

        /* æŒ‰é’® */
        #finish-btn {
            background: #f1c40f;
            color: #333;
            border: 2px solid #333;
            padding: 6px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 800;
            display: none;
            margin: 3px auto 0;
            font-size: 13px;
            box-shadow: 0 3px #d35400;
            transition: all 0.1s;
            pointer-events: auto;
        }
        #finish-btn:active { box-shadow: 0 0 #d35400; transform: translateY(3px); }

        /* åŠ¨æ•ˆå®šä¹‰ */
        @keyframes idle-bounce { 0%, 100% { transform: scale(1, 1) translateY(0); } 50% { transform: scale(1.05, 0.95) translateY(6px); } }
        .anim-fly-away { animation: fly-away 1.5s forwards ease-in !important; }
        @keyframes fly-away { 0% { transform: translate(0, 0) rotate(0deg) scale(1); opacity: 1; } 100% { transform: translate(150px, -300px) rotate(120deg) scale(0); opacity: 0; } }
        .anim-spin { animation: spin 2s infinite linear !important; }
        @keyframes spin { 0% { transform: rotate(0deg); } 25% { transform: rotate(-15deg); } 75% { transform: rotate(15deg); } 100% { transform: rotate(0deg); } }
        .anim-shake { animation: shake 1s infinite ease-in-out !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px) rotate(-5deg); } 75% { transform: translateX(10px) rotate(5deg); } }
        .anim-bounce { animation: bounce 0.8s infinite ease-in-out !important; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .anim-stretch { animation: stretch 1.5s infinite ease-in-out !important; }
        @keyframes stretch { 0%, 100% { transform: scale(1, 1); } 50% { transform: scale(0.9, 1.1) translateY(-10px); } }
        .anim-breathe { animation: breathe-deep 2s infinite ease-in-out !important; }
        @keyframes breathe-deep { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        @keyframes shake-tiny { 0%, 100% { transform: translateX(-50%) rotate(0deg); } 25% { transform: translateX(-51%) rotate(-1deg); } 75% { transform: translateX(-49%) rotate(1deg); } }
        
        .effect-text {
            position: absolute; font-weight: 900; pointer-events: none; left: 50%; transform: translateX(-50%);
            z-index: 300; width: 240px; text-align: center; font-size: 16px; text-shadow: 2px 2px 0 #fff; white-space: nowrap;
        }
        @keyframes float-up { 0% { opacity: 1; top: -30px; transform: translateX(-50%) scale(0.8); } 100% { opacity: 0; top: -120px; transform: translateX(-50%) scale(1.5); } }
    </style>
</head>
<body>
    <div id="pet-container">
        <div class="leopard-visual" id="leopard">ğŸ†</div>
        <div class="bubble" id="banner">
            <h3 id="action-title">å‡†å¤‡</h3>
            <p id="action-desc">...</p>
            <div id="countdown-display">10</div>
            <button id="finish-btn">ğŸ’° æ‰“å¡è¿›é’±</button>
        </div>
        <div id="piggy-bank">
            <div class="info-row">
                <span>â³ <span id="work-timer">00:00</span></span>
                <span style="color:#ddd">|</span>
                <span>ğŸ’° æœ¬é’±: <span id="money-count" style="color:#d35400; font-weight:bold;">0</span></span>
            </div>
            <div class="control-buttons">
                <button id="locate-btn" title="å®šä½åˆ°å·¦ä¸‹è§’">ğŸ“</button>
                <button id="pause-btn" title="æš‚åœ/æ’­æ”¾">â¸ï¸</button>
                <button id="reset-btn" title="é‡æ–°å¼€å§‹">ğŸ”„</button>
            </div>
        </div>
    </div>

    <script>
        // === 1. ç”Ÿäº§ç¯å¢ƒé…ç½® (æ—¶é—´å•ä½ï¼šç§’) ===
        const CONFIG = {
            WORK_TIME_SECONDS: 25 * 60,      // å·¥ä½œ 25åˆ†é’Ÿ
            EXERCISE_TOTAL_SECONDS: 5 * 60,  // ä¼‘æ¯ 5åˆ†é’Ÿ
            URGENT_SECONDS: 10               // æœ€å 10ç§’å€’è®¡æ—¶
        };

        // === 2. åŠ¨ä½œæ•°æ®åº“ (ç²¾ç®€å±•ç¤ºï¼Œå…¨é‡è¯·å¤åˆ¶ä¹‹å‰çš„52æ¡) ===
        const exerciseLibrary = [
             { t: "å¤©é¹…é¢ˆ", d: "ç”¨é¼»å°–åœ¨ç©ºä¸­å†™ä¸€ä¸ª'8'å­—ï¼Œå¯“æ„å‘å‘å‘", icon: "ğŸ¦’", anim: "anim-spin" },
             { t: "æ‹’ç»ç©·ç¥", d: "ç¼“æ…¢å·¦å³è½¬å¤´ï¼Œå¯¹ç©·ç¥åšå®šåœ°è¯´ä¸", icon: "ğŸ™…â€â™‚ï¸", anim: "anim-shake" },
             { t: "è€¸è‚©è—é‡‘", d: "ç”¨åŠ›è€¸è‚©æ‰¾è€³æœµï¼Œå¤¹ä½é‡‘å¸ä¸æ‰ä¸‹æ¥", icon: "ğŸ¤·â€â™‚ï¸", anim: "anim-bounce" },
             { t: "æ‘˜é‡‘è‹¹æœ", d: "å·¦æ‰‹å³æ‰‹è½®æµå‘ä¸Šç”¨åŠ›æŠ“å–ï¼é«˜å¤„æœ‰é’±ï¼", icon: "ğŸ™‹â€â™‚ï¸", anim: "anim-stretch" },
             { t: "æ‹›è´¢çŒ«æ‰‹", d: "æ‰‹è…•ç”¨åŠ›å‘å¤–æ¨ï¼ŒæŠŠå‹åŠ›ç»Ÿç»Ÿæ¨èµ°", icon: "ğŸ‘", anim: "anim-shake" },
             { t: "è½¬è¿å‘¼å•¦åœˆ", d: "æƒ³è±¡è…°ä¸Šæœ‰ä¸ªå‘¼å•¦åœˆï¼Œæ…¢æ…¢è½¬åŠ¨", icon: "ğŸ¡", anim: "anim-spin" },
             { t: "å¤¹ç´§é’±åŒ…", d: "ç”¨åŠ›æ”¶ç´§è‡€éƒ¨è‚Œè‚‰ï¼Œå¤¹ç´§ï¼åˆ«æ¾æ°”ï¼", icon: "ğŸ‘", anim: "anim-breathe" },
             { t: "æ­¥æ­¥é«˜å‡", d: "åŸåœ°è¸æ­¥ï¼Œè†ç›–æŠ¬é«˜ï¼", icon: "ğŸƒ", anim: "anim-bounce" },
             { t: "è‚¡å¸‚å¤§ç›˜", d: "çœ¼çƒä¸Šä¸‹çœ‹ï¼Œæ¨¡æ‹Ÿçœ‹Kçº¿å›¾èµ°åŠ¿", icon: "ğŸ‘€", anim: "anim-bounce" },
             // ... ä½ å¯ä»¥æŠŠä¹‹å‰å®Œæ•´çš„52æ¡å¤åˆ¶å›è¿™é‡Œ ...
        ];
        
        const urgentTexts = ["æ•‘æ•‘ï¼æ•‘æ•‘è„–å­ï¼ğŸ˜±", "é’±è¦é£èµ°å•¦ï¼ğŸ’¸", "èº«ä½“æœ¬é’±è¦æ²¡å•¦ï¼ğŸ“‰", "å¿«åŠ¨åŠ¨ï¼è¦ç”Ÿé”ˆäº†ï¼ğŸ¤–", "ä¸ºäº†å…»è€é‡‘ï¼å†²å•Šï¼ğŸ‘µ"];

        const state = {
            isWorking: true,
            isExercising: false,
            isPaused: false,
            money: 0,
            countdownTimer: null,
            workTimer: null,
            workSecondsRemaining: CONFIG.WORK_TIME_SECONDS
        };
        const elements = {
            pet: document.getElementById('pet-container'),
            leopard: document.getElementById('leopard'),
            bubble: document.getElementById('banner'),
            finishBtn: document.getElementById('finish-btn'),
            actionTitle: document.getElementById('action-title'),
            actionDesc: document.getElementById('action-desc'),
            countdownDisplay: document.getElementById('countdown-display'),
            moneyCount: document.getElementById('money-count'),
            workTimerDisplay: document.getElementById('work-timer'),
            topBar: document.getElementById('piggy-bank'),
            locateBtn: document.getElementById('locate-btn'),
            pauseBtn: document.getElementById('pause-btn'),
            resetBtn: document.getElementById('reset-btn')
        };

        // === 3. Electron äº¤äº’é€»è¾‘ (å…³é”®) ===
        // å½“é¼ æ ‡è¿›å…¥å® ç‰©åŒºåŸŸæ—¶ï¼Œé€šçŸ¥Electron"æˆ‘è¦æ“ä½œ"ï¼Œå¦åˆ™"è¯·ç©¿é€æˆ‘"
        if (typeof require !== 'undefined') {
            const { ipcRenderer } = require('electron');

            const setInteractive = (interactive) => {
                // å‘é€æ¶ˆæ¯ç»™ä¸»è¿›ç¨‹ï¼šå¦‚æœæ˜¯ trueï¼Œåˆ™æ•è·é¼ æ ‡ï¼›å¦‚æœæ˜¯ falseï¼Œåˆ™ç©¿é€
                ipcRenderer.send('set-ignore-mouse-events', !interactive, { forward: true });
            };

            // ç›‘å¬å® ç‰©å®¹å™¨
            elements.pet.addEventListener('mouseenter', () => setInteractive(true));
            elements.pet.addEventListener('mouseleave', () => setInteractive(false));
        }

        // === 4. ä¸šåŠ¡é€»è¾‘ ===
        function startWorkLoop() {
            state.isWorking = true;
            state.isPaused = false;
            resetVisuals();
            state.workSecondsRemaining = CONFIG.WORK_TIME_SECONDS;
            updateTimerUI(state.workSecondsRemaining);
            updatePauseButton();
            if(state.workTimer) clearInterval(state.workTimer);
            state.workTimer = setInterval(() => {
                if (!state.isPaused) {
                    state.workSecondsRemaining--;
                    updateTimerUI(state.workSecondsRemaining);
                    if (state.workSecondsRemaining <= 0) {
                        clearInterval(state.workTimer);
                        startExercise();
                    }
                }
            }, 1000);
        }

        function updateTimerUI(seconds) {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            elements.workTimerDisplay.innerText = `${m}:${s}`;
        }

        function startExercise() {
            state.isWorking = false;
            state.isExercising = true;
            // æ’­æ”¾éŸ³æ•ˆ (å¯æ·»åŠ )
            const action = exerciseLibrary[Math.floor(Math.random() * exerciseLibrary.length)];
            elements.actionTitle.innerText = action.t;
            elements.actionDesc.innerText = action.d;
            elements.leopard.innerText = action.icon;
            elements.leopard.className = "leopard-visual"; 
            void elements.leopard.offsetWidth; 
            elements.leopard.classList.add(action.anim);
            elements.bubble.style.display = 'block';
            elements.actionDesc.style.display = 'block';
            elements.finishBtn.style.display = 'none';
            elements.countdownDisplay.style.display = 'none';

            const instructionTime = (CONFIG.EXERCISE_TOTAL_SECONDS - CONFIG.URGENT_SECONDS) * 1000;
            setTimeout(() => { startCountdownSequence(); }, instructionTime);
        }

        function startCountdownSequence() {
            if (!state.isExercising) return;
            const randomText = urgentTexts[Math.floor(Math.random() * urgentTexts.length)];
            elements.pet.classList.add('urgent-mode');
            elements.actionTitle.innerText = randomText;
            elements.actionDesc.style.display = 'none'; 
            elements.finishBtn.style.display = 'block'; 
            elements.countdownDisplay.style.display = 'block';
            let secondsLeft = CONFIG.URGENT_SECONDS;
            elements.countdownDisplay.innerText = secondsLeft;
            if(state.countdownTimer) clearInterval(state.countdownTimer);
            state.countdownTimer = setInterval(() => {
                secondsLeft--;
                elements.countdownDisplay.innerText = secondsLeft;
                if (secondsLeft <= 0) handleTimeout();
            }, 1000);
        }

        function handleTimeout() {
            clearInterval(state.countdownTimer);
            elements.leopard.innerText = "ğŸ’¸"; 
            elements.leopard.className = "leopard-visual anim-fly-away";
            elements.actionTitle.innerText = "é£èµ°äº†...";
            elements.finishBtn.style.display = 'none';
            elements.countdownDisplay.style.display = 'none';
            showEffect("èº«ä½“æœ¬é’± -1", "#7f8c8d");
            setTimeout(() => { state.isExercising = false; startWorkLoop(); }, 1600);
        }

        elements.finishBtn.addEventListener('click', (e) => {
            e.stopPropagation(); 
            if (state.countdownTimer) clearInterval(state.countdownTimer);
            completeAndReward();
        });

        function completeAndReward() {
            state.isExercising = false;
            elements.leopard.innerText = "ğŸ¤‘"; 
            elements.leopard.className = "leopard-visual"; 
            elements.leopard.style.animation = "idle-bounce 0.4s infinite"; 
            addMoney(10);
            setTimeout(() => { startWorkLoop(); }, 1500);
        }

        function resetVisuals() {
            elements.pet.classList.remove('urgent-mode');
            elements.bubble.style.display = 'none';
            elements.leopard.innerText = "ğŸ†";
            elements.leopard.className = "leopard-visual"; 
            elements.leopard.style.animation = ""; 
        }

        function addMoney(amount) {
            state.money += amount;
            elements.moneyCount.innerText = state.money;
            showEffect("+ğŸ’° æ‰“å¡è¿›è´¦", "#f1c40f");
        }

        function showEffect(text, color) {
            const effect = document.createElement('div');
            effect.className = 'effect-text';
            effect.innerText = text;
            effect.style.color = color;
            effect.style.animation = "float-up 1.5s forwards";
            elements.pet.appendChild(effect);
            setTimeout(() => effect.remove(), 1500);
        }

        elements.pet.addEventListener('click', () => {
            if (state.isExercising) return;
            const randomFace = ["ğŸ˜¸", "ğŸ˜º", "ğŸ˜½"];
            elements.leopard.innerText = randomFace[Math.floor(Math.random() * randomFace.length)];
            setTimeout(() => elements.leopard.innerText = "ğŸ†", 800);
        });

        // === æŒ‰é’®åŠŸèƒ½ ===
        // å®šä½æŒ‰é’®ï¼šç§»åŠ¨åˆ°å·¦ä¸‹è§’
        elements.locateBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            // å·¦ä¸‹è§’ç•™å‡ºè¾¹è·
            elements.pet.style.left = '100px';
            elements.pet.style.top = (screenHeight - 300) + 'px';
            elements.pet.style.transform = 'none';
        });

        // æš‚åœ/æ’­æ”¾æŒ‰é’®
        elements.pauseBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            state.isPaused = !state.isPaused;
            updatePauseButton();
        });

        function updatePauseButton() {
            elements.pauseBtn.innerText = state.isPaused ? 'â–¶ï¸' : 'â¸ï¸';
            elements.pauseBtn.title = state.isPaused ? 'æ’­æ”¾' : 'æš‚åœ';
        }

        // é‡å¯æŒ‰é’®
        elements.resetBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (state.workTimer) clearInterval(state.workTimer);
            if (state.countdownTimer) clearInterval(state.countdownTimer);
            state.isExercising = false;
            startWorkLoop();
        });

        // æ‹–æ‹½ - ä¿®å¤å®šä½é—®é¢˜
        let isDragging = false;
        let dragStartX, dragStartY, initialLeft, initialTop;

        elements.pet.addEventListener('mousedown', (e) => {
            // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®,ä¸è§¦å‘æ‹–æ‹½
            if (e.target.tagName === 'BUTTON') return;

            isDragging = true;
            dragStartX = e.clientX;
            dragStartY = e.clientY;

            const rect = elements.pet.getBoundingClientRect();
            initialLeft = rect.left;
            initialTop = rect.top;

            elements.pet.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const dx = e.clientX - dragStartX;
            const dy = e.clientY - dragStartY;
            elements.pet.style.left = (initialLeft + dx) + 'px';
            elements.pet.style.top = (initialTop + dy) + 'px';
            elements.pet.style.transform = 'none';
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                elements.pet.style.cursor = 'grab';
            }
        });
        
        startWorkLoop();
    </script>
</body>
</html>